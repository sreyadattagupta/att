<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Portal - Attendify</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .active-tab {
      background-color: #4f46e5;
      color: white;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-white shadow-sm">
    <nav class="container mx-auto px-4 flex justify-between items-center h-16">
      <a href="index.html" class="text-2xl font-bold text-indigo-600">Attendify</a>
      <a href="index.html" class="text-sm text-gray-600 hover:text-indigo-600">&larr; Back to Home</a>
    </nav>
  </header>

  <main class="w-full flex items-center justify-center min-h-[calc(100vh-128px)] p-4">
    <div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl border border-gray-100">
      <div class="flex mb-6">
        <button id="loginTab" class="w-1/2 py-2 font-semibold rounded-l-xl active-tab">Login</button>
        <button id="registerTab" class="w-1/2 py-2 font-semibold rounded-r-xl bg-gray-100 hover:bg-gray-200">Register</button>
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="form-section">
        <h2 class="text-2xl font-bold text-center mb-2">Student Login</h2>
        <p class="text-center text-gray-600 mb-6">Welcome back!</p>

        <label class="block text-sm font-medium mb-2">Registration Number</label>
        <input id="loginRegNumber" type="text" class="w-full px-4 py-3 mb-4 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500" placeholder="e.g. 202512345" required />

        <label class="block text-sm font-medium mb-2">Password</label>
        <input id="loginPassword" type="password" class="w-full px-4 py-3 mb-6 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500" placeholder="Last 4 digits of reg. number" required />

        <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-xl hover:bg-indigo-700 transition">Login</button>
      </form>

      <!-- Register Form -->
      <form id="registerForm" class="form-section hidden">
        <h2 class="text-2xl font-bold text-center mb-2">Student Registration</h2>
        <p class="text-center text-gray-600 mb-6">Create your student account</p>

        <label class="block text-sm font-medium mb-2">Registration Number</label>
        <input id="registerRegNumber" type="text" class="w-full px-4 py-3 mb-6 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500" placeholder="e.g. 202512345" required />

        <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-xl hover:bg-indigo-700 transition">Register</button>
      </form>
    </div>
  </main>

  <!-- Modal -->
  <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full text-center">
      <h3 id="modalTitle" class="text-2xl font-bold mb-4"></h3>
      <p id="modalMessage" class="text-gray-600 mb-6"></p>
      <button id="closeModal" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition">Close</button>
    </div>
  </div>

  <script>
    const API_URL = "http://localhost:3000"; // Your Express backend

    const loginTab = document.getElementById("loginTab");
    const registerTab = document.getElementById("registerTab");
    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");

    // Toggle tabs
    loginTab.addEventListener("click", () => {
      loginTab.classList.add("active-tab");
      registerTab.classList.remove("active-tab");
      loginForm.classList.remove("hidden");
      registerForm.classList.add("hidden");
    });
    registerTab.addEventListener("click", () => {
      registerTab.classList.add("active-tab");
      loginTab.classList.remove("active-tab");
      registerForm.classList.remove("hidden");
      loginForm.classList.add("hidden");
    });

    // Modal logic
    const modal = document.getElementById("messageModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalMessage = document.getElementById("modalMessage");
    const closeModal = document.getElementById("closeModal");
    const showModal = (title, msg, error = false) => {
      modalTitle.textContent = title;
      modalMessage.textContent = msg;
      modalTitle.className = error ? "text-2xl font-bold mb-4 text-red-600" : "text-2xl font-bold mb-4 text-gray-900";
      modal.classList.remove("hidden");
    };
    closeModal.addEventListener("click", () => modal.classList.add("hidden"));

    // Student Registration
    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const regNumber = document.getElementById("registerRegNumber").value.trim();
      if (!regNumber || regNumber.length < 4) {
        showModal("Error", "Please enter a valid registration number.", true);
        return;
      }
      const password = regNumber.slice(-4);

      try {
        const res = await fetch(`${API_URL}/student/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ regNumber, password }),
        });
        const data = await res.json();
        if (res.ok) {
          showModal("Success", "Student registered successfully!");
        } else {
          showModal("Error", data.message || "Registration failed.", true);
        }
      } catch (err) {
        showModal("Error", "Server not reachable.", true);
      }
    });

    // Student Login
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const regNumber = document.getElementById("loginRegNumber").value.trim();
      const password = document.getElementById("loginPassword").value.trim();

      if (!regNumber || !password) {
        showModal("Error", "Please fill in all fields.", true);
        return;
      }

      try {
        const res = await fetch(`${API_URL}/student/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ regNumber, password }),
        });
        const data = await res.json();

        if (res.ok) {
          sessionStorage.setItem("studentRegNumber", regNumber);
          showModal("Login Successful", "Redirecting to your dashboard...");
          setTimeout(() => (window.location.href = "./studentdashboard.html"), 2000);
        } else {
          showModal("Error", data.message || "Invalid credentials", true);
        }
      } catch (err) {
        showModal("Error", "Server not reachable.", true);
      }
    });
  </script>
</body>
</html>
